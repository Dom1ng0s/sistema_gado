<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Agendamentos - Sistema Gado</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .status-badge { padding: 5px 10px; border-radius: 15px; font-size: 0.8em; font-weight: bold; }
        .pendente { background-color: #fff3e0; color: #ef6c00; }
        .pago { background-color: #e8f5e9; color: #2e7d32; }
        .vencido { color: #d32f2f; font-weight: bold; }
    </style>
</head>
<body>
    <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #2e7d32; padding-bottom: 10px; margin-bottom: 20px;">
        <h1 style="border: none; margin: 0;">ðŸ“… Contas a Pagar</h1>
        <a href="{{ url_for('financeiro.financeiro') }}" class="btn btn-secondary">Voltar ao Financeiro</a>
    </div>

    {% if mensagem %}
        <div class="alert">{{ mensagem }}</div>
    {% endif %}

    <div class="form-container">
        <h3>Novo Agendamento</h3>
        <form action="{{ url_for('financeiro.agendamentos') }}" method="POST">
            <div class="form-group">
                <label>DescriÃ§Ã£o:</label>
                <input type="text" name="descricao" required placeholder="Ex: Parcela RaÃ§Ã£o 1/3">
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label>Valor (R$):</label>
                    <input type="number" step="0.01" name="valor" required placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Vencimento:</label>
                    <input type="date" name="vencimento" required>
                </div>
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">ðŸ’¾ AGENDAR PAGAMENTO</button>
        </form>
    </div>

    <h3 style="margin-top: 30px; color: #555;">PrÃ³ximos Vencimentos</h3>
    <table>
        <thead>
            <tr>
                <th>Vencimento</th>
                <th>DescriÃ§Ã£o</th>
                <th>Valor</th>
                <th>Status</th>
                <th style="text-align: center;">AÃ§Ãµes</th> </tr>
        </thead>
        <tbody>
            {% for conta in agendamentos %}
            <tr>
                <td class="{% if conta[3] < hoje and conta[4] == 'pendente' %}vencido{% endif %}">
                    {{ conta[3].strftime('%d/%m/%Y') }}
                </td>
                <td>{{ conta[1] }}</td>
                <td>R$ {{ "%.2f"|format(conta[2]) }}</td>
                <td>
                    <span class="status-badge {{ conta[4] }}">{{ conta[4]|upper }}</span>
                </td>
                <td style="text-align: center;">
                    {% if conta[4] == 'pendente' %}
                        <a href="{{ url_for('financeiro.baixar_agendamento', id_agendamento=conta[0]) }}" 
                           class="btn" 
                           style="background-color: #2e7d32; color: white; padding: 5px 10px; font-size: 0.8em; text-decoration: none;"
                           title="Confirmar Pagamento e LanÃ§ar no Caixa"
                           onclick="return confirm('Confirma o pagamento de {{ conta[1] }}? Isso lanÃ§arÃ¡ o valor no Fluxo de Caixa.');">
                           âœ… Pagar
                        </a>
                    {% else %}
                        <span style="color: #aaa; font-size: 0.8em;">--</span>
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" style="text-align: center; padding: 20px; color: #777;">
                    Nenhuma conta agendada.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>